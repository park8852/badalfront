# 바로배달 사용자 역할별 분기 흐름도

## 🔐 전체 인증 및 분기 흐름

```
                    로그인 페이지 (/login)
                            ↓
                    사용자 입력 (ID/PW)
                            ↓
                    백엔드 인증 요청
                            ↓
                    백엔드 응답 (role 포함)
                            ↓
                    ┌─────────────────────────────────┐
                    │        role 확인 분기            │
                    └─────────────────────────────────┘
                            ↓
        ┌───────────────────┼───────────────────┐
        ↓                   ↓                   ↓
   ADMIN 역할           OWNER 역할          USER 역할
        ↓                   ↓                   ↓
   /admin 페이지        대시보드 이동        / 페이지
        ↓                   ↓                   ↓
   관리자 기능          사장님 기능          고객 기능
```

## 👑 ADMIN (관리자) 분기 흐름

```
로그인 성공 (role: "ADMIN")
        ↓
authInfo 저장 { role: "ADMIN", token, userId }
        ↓
router.replace("/admin")
        ↓
┌─────────────────────────────────────────┐
│           관리자 페이지 접근             │
└─────────────────────────────────────────┘
        ↓
useEffect 권한 확인
        ↓
authInfo?.role === "ADMIN" ? 
        ↓ (true)
관리자 페이지 렌더링
        ↓
┌─────────────────────────────────────────┐
│              관리자 기능                │
├─────────────────────────────────────────┤
│ • 전체 가게 관리 (/admin/stores)        │
│ • 전체 주문 관리 (/admin/orders)        │
│ • 공지사항 관리 (/admin/notices)        │
│ • 시스템 통계 (사용자/가게/주문/매출)   │
│ • 가게 승인/거부/삭제                   │
│ • 주문 전체 조회 및 관리                │
│ • 공지사항 작성/수정/삭제               │
└─────────────────────────────────────────┘
        ↓
사이드바 표시
        ↓
┌─────────────────────────────────────────┐
│            관리자 사이드바              │
├─────────────────────────────────────────┤
│ • 관리자 대시보드 (제목)                │
│ • 관리자 페이지 링크                    │
│ • 공지사항 링크                         │
│ • 로그아웃                              │
└─────────────────────────────────────────┘
```

## 🏪 OWNER (사장님) 분기 흐름

```
로그인 성공 (role: "OWNER")
        ↓
authInfo 저장 { role: "OWNER", token, userId, storeId }
        ↓
onLoginSuccess() 호출
        ↓
┌─────────────────────────────────────────┐
│           사장님 대시보드 접근           │
└─────────────────────────────────────────┘
        ↓
useEffect 권한 확인
        ↓
authInfo?.role === "OWNER" ? 
        ↓ (true)
사장님 대시보드 렌더링
        ↓
┌─────────────────────────────────────────┐
│              사장님 기능                │
├─────────────────────────────────────────┤
│ • 주문 관리 (/dashboard)                │
│ • 메뉴 관리 (/menu)                     │
│ • 가게 정보 관리 (/store)               │
│ • 매출 관리 (/revenue)                  │
│ • 내 가게 주문만 조회                   │
│ • 메뉴 추가/수정/삭제                   │
│ • 가게 정보 수정                        │
│ • 매출 통계 및 분석                     │
└─────────────────────────────────────────┘
        ↓
사이드바 표시
        ↓
┌─────────────────────────────────────────┐
│            사장님 사이드바              │
├─────────────────────────────────────────┤
│ • 사장님 대시보드 (제목)                │
│ • 주문 관리 링크                        │
│ • 메뉴 관리 링크                        │
│ • 가게 관리 링크                        │
│ • 공지사항 링크                         │
│ • 로그아웃                              │
└─────────────────────────────────────────┘
```

## 👤 USER (일반고객) 분기 흐름

```
로그인 성공 (role: "USER")
        ↓
authInfo 저장 { role: "USER", token, userId }
        ↓
router.replace("/")
        ↓
┌─────────────────────────────────────────┐
│           고객 홈페이지 접근             │
└─────────────────────────────────────────┘
        ↓
useEffect 권한 확인
        ↓
authInfo?.role === "USER" ? 
        ↓ (true)
고객 페이지 렌더링
        ↓
┌─────────────────────────────────────────┐
│              고객 기능                  │
├─────────────────────────────────────────┤
│ • 가게 목록 조회                        │
│ • 메뉴 주문                            │
│ • 주문 내역 확인                        │
│ • 공지사항 확인                         │
│ • 프로필 관리                           │
│ • 결제 및 배달 추적                     │
└─────────────────────────────────────────┘
        ↓
사이드바 표시 (제한적)
        ↓
┌─────────────────────────────────────────┐
│            고객 사이드바                │
├─────────────────────────────────────────┤
│ • 홈 링크                              │
│ • 주문 내역 링크                        │
│ • 공지사항 링크                         │
│ • 프로필 링크                          │
│ • 로그아웃                              │
└─────────────────────────────────────────┘
```

## 🔒 권한별 페이지 접근 제어

### 관리자 전용 페이지
```
/admin/* → authInfo?.role === "ADMIN" 확인
├─ /admin (메인 대시보드)
├─ /admin/stores (가게 관리)
├─ /admin/orders (주문 관리)
└─ /admin/notices (공지사항 관리)
```

### 사장님 전용 페이지
```
/dashboard → authInfo?.role === "OWNER" 확인
/menu → authInfo?.role === "OWNER" 확인
/store → authInfo?.role === "OWNER" 확인
/revenue → authInfo?.role === "OWNER" 확인
```

### 공통 접근 페이지
```
/ → 모든 역할 접근 가능
/notices → 모든 역할 접근 가능
/login → 로그인 안된 사용자만
```

## 🚫 권한 없을 때 처리

```
권한 없는 페이지 접근
        ↓
useEffect에서 권한 확인
        ↓
authInfo?.role !== "ADMIN" (또는 해당 역할)
        ↓
router.replace("/login")
        ↓
로그인 페이지로 리다이렉트
        ↓
재로그인 필요
```

## 📱 사이드바 조건부 렌더링

```typescript
// 관리자 페이지 링크
{isClient && authInfo?.role === "ADMIN" && (
  <Link href="/admin">관리자 페이지</Link>
)}

// 대시보드 제목
{isClient && authInfo?.role === "ADMIN" 
  ? "관리자 대시보드" 
  : "사장님 대시보드"
}

// 사용자 역할 표시
{authInfo.role === "ADMIN" ? "관리자" : "사장님"}
```

## 🔄 상태 관리 흐름

```
1. 로그인 → authInfo 저장 (localStorage)
2. 페이지 접근 → authInfo 확인
3. 권한 확인 → 페이지 렌더링 또는 리다이렉트
4. 사이드바 → authInfo 기반 조건부 렌더링
5. 로그아웃 → authInfo 삭제 → /login 리다이렉트
```

## 🛡️ 보안 계층

```
1단계: 로그인 시 역할 확인
2단계: 페이지 접근 시 권한 재확인
3단계: API 요청 시 토큰 검증
4단계: 클라이언트 사이드 UI 제어
5단계: 서버 사이드 최종 권한 검증
```

이러한 다층 보안 구조로 각 사용자 역할에 맞는 기능과 페이지에만 접근할 수 있도록 제어하고 있습니다.
